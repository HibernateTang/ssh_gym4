<!DOCTYPE html>
<html lang="zh-CN">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>登陆丨TheLittleGym</title>
<link rel="stylesheet" href="css/login.css">
<link rel="stylesheet" href="css/swiper-3.4.2.min.css">
<link rel="stylesheet" href="css/animate.css">
<script src="js/jquery-1.11.3.min.js"></script>
<script src="js/swiper-3.4.2.jquery.min.js"></script>
<!--背景图片自动更换-->
<script src="js/supersized.3.2.7.min.js"></script>
<script src="js/supersized-init.js"></script>
<script src="js/fastclick.js"></script>
<script>

    $(document).ready(function () {
        $(function () {
            FastClick.attach(document.body);
        });

        var mySwiper = new Swiper('.swiper-container', {})

        mySwiper.lockSwipes();
        $("#goSignIn").click(function () {
            mySwiper.unlockSwipes();
            mySwiper.slideNext(fadeInClass());
            mySwiper.lockSwipes();
        })

        $("#goSignUp").click(function () {
            mySwiper.unlockSwipes();
            mySwiper.slidePrev(fadeInClass());
            mySwiper.lockSwipes();
        })

        function fadeInClass() {
            if ($("#loginConnect p").hasClass("animated bounceInLeft")) {
                $("#loginConnect p").removeClass("animated bounceInLeft");
                $("#regConnect p").addClass("animated bounceInLeft")
            } else {
                $("#regConnect p").removeClass("animated bounceInLeft")
                $("#loginConnect p").addClass("animated bounceInLeft");
            }
            emptyInputs();
        }

        // 清空所有input
        function emptyInputs() {
            $("input").val("");
        }

        $("#signIn").click(function () {
            if (checkLogin()) {
                var tel = $("#login_tel").val();
                var pass = $("#login_pass").val();
                login_ajax(tel,pass);
            }
        })

        $("#signUp").click(function(){
            if (checkLogin()) {
                var tel = $("#reg_tel").val();
                var pass = $("#reg_pass").val();
                login_ajax(tel,pass);
            }
        })

        function checkLogin() {
            //手机
            var telChecked = checkInput(/^1[34578]\d{9}$/, $("#login_tel"), "手机", "手机号格式不正确");
            var passChecked = checkInput(/^(\w){6,20}$/, $("#login_pass"), "密码", "6-20个字母、数字、下划线");
            return telChecked && passChecked;
        }

        function checkReg(){
            //手机
            var telChecked = checkInput(/^1[34578]\d{9}$/, $("#reg_tel"), "手机", "手机号格式不正确");
            var passChecked = checkInput(/^(\w){6,20}$/, $("#reg_pass"), "密码", "6-20个字母、数字、下划线");
            var mailChecked = checkInput(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/, $("#reg_mail"), "输入邮箱地址", "邮箱格式不正确");
            return telChecked &&  passChecked && mailChecked;
        }
        function checkInput(regx, ele, ph, phErr) {
            if (!regx.test($.trim(ele.val()))) {
                ele.val("");
                ele.addClass("input-error");
                ele.attr("placeholder", phErr);
                return false;
            } else {
                ele.removeClass("input-error");
                ele.attr("placeholder", ph);
                return true;
            }
        }

        function login_ajax(telephone, password) {
            this.username = telephone;
//            this.password = hex_md5(password);
            this.password = password;
            $.ajax({
                type: "POST",
                url: "/login/tologin",
                data: {"username": this.username, "password": this.password},
                contentType: "application/x-www-form-urlencoded",
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    if (data.success == true && data.message == "登录成功") {
                        alert("登录成功!");

                        window.location.href = "/index";
//                            window.location.href = "../jsp/infojsp/info.jsp?userName="+data.value.username+
//                                    "&userId="+data.value.id;
                    } else if (data.success == false && data.message == "密码错误") {
                        alert("密码错误!");
                    } else if (data.success == false && data.message == "该用户不存在!") {
                        alert("该用户不存在!");
                    }
                }
            });
        }

        function regsister_ajax(username, password,email) {
            this.username = username;
            this.password = password;
            this.email = email;
            $.ajax({
                type: "POST",
                url: "/login/register",
                data: {"username": this.username, "password": this.password,"email":this.email},
                contentType: "application/x-www-form-urlencoded",
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    if (data.success == true && data.message == "注册成功") {
                        alert("注册成功!");
                        mySwiper.unlockSwipes();
                        mySwiper.slidePrev(fadeInClass());
                        mySwiper.lockSwipes();
                    } else if (data.success == false && data.message == "该用户名已存在...") {
                        alert("该用户名已被注册...");
                    }
                }
            });
        }

    });

</script>

<body>
<div class="swiper-container">
    <div class="swiper-wrapper">
        <div class="swiper-slide">
            <div class="login-container">
                <h1>The Little Gym</h1>

                <div class="connect" id="loginConnect">
                    <p class="animated bounceInLeft">给孩子一生的自信和成功</p>

                </div>

                <div class="loginForm" id="loginForm">
                    <div>
                        <input type="text" name="telephone" class="telephone" id="login_tel" placeholder="手机"
                               autocomplete="off"/>

                    </div>
                    <div>
                        <input type="password" name="password" id="login_pass" class="password" placeholder="密码"
                               oncontextmenu="return false" onpaste="return false"
                        />
                    </div>
                    <button id="signIn">登 陆</button>
                </div>

                <a href="javascrit:void(0)" id="goSignIn">
                    <button type="button" class="register-tis">还有没有账号？</button>
                </a>

            </div>
        </div>
        <div class="swiper-slide">
            <div class="register-container">
                <h1>The Little Gym</h1>

                <div class="connect" id="regConnect">
                    <p>给孩子一生的自信和成功</p>
                </div>

                <div class="loginForm" id="registerForm">
                    <div>
                        <input type="text" class="reg_tel" id="reg_tel" placeholder="输入手机号码"
                               autocomplete="off" />
                    </div>

                    <div>
                        <input type="password"  class="reg_pass" id="reg_pass" placeholder="输入密码"
                               oncontextmenu="return false" onpaste="return false"
                        />
                    </div>
                    <div>
                        <input type="password" id="reg_repass" class="reg_repass"
                               placeholder="再次输入密码" oncontextmenu="return false"
                               onpaste="return false"/>
                    </div>
                    <div>
                        <input type="email" name="email" class="email" id="reg_email" placeholder="输入邮箱地址"
                               oncontextmenu="return false" onpaste="return false"/>
                    </div>

                    <button id="signUp">注 册</button>
                </div>
                <a href="javascrit:void(0)" id="goSignUp">
                    <button type="button" class="register-tis">已经有账号？</button>
                </a>

            </div>
        </div>
    </div>
</div>


</body>
</html>